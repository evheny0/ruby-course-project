<div class="main-content">
    <div class="page-header">
        <h1>Editing creative<small> | <%= link_to 'Show', @creative %></small></h1>
    </div>
    
    <div class="col-md-7">
        <div class="well">
            <%= render 'form' %>
        </div>
    </div>
    <div class="col-md-5">
        <div class="list-group">
            <a class="list-group-item item" >
                <h4 class="list-group-item-heading">Creative info</h4>
            </a>
        </div>
        <h4 align="center">Chapters:</h4>
        <div id="chapters" class="list-group">
            <% @creative.chapters.sort_by{|e| e[:order]}.each do |chapter| %>
                <a id=<%= chapter.order %> class="list-group-item item" data-toggle="button" data-id=<%= chapter.id %>>
                    <h4 class="list-group-item-heading"><%= chapter.title %></h4>
                </a>
            <% end %>
        </div>
        <div class="list-group">
            <a class="list-group-item item add" >
                <h4 class="list-group-item-heading">Add new</h4>
            </a>
        </div>
    </div>
</div>

<%= javascript_include_tag "creatives" %>
<script>
    (function() {
        creativeUrl = "/creatives/<%= @creative.id %>/reorder_chapters";
        chapterEditUrl = "/chapters/";
        creativeEditUrl = "/creatives/<%= @creative.id %>/edit.json";
        $("#chapters").sortable();
        var sorted = $("#chapters").sortable("serialize");
        
        $("#chapters").on("sortupdate", function() {
            var order = $("#chapters").sortable("toArray");
            $.ajax({
                url: creativeUrl + "/?order=" + order.join(""),
            });
            $("#chapters").find("a").each(function(i) {
                $(this).attr("id", i);
            });
        });

        $(document).on("click", ".item", function() {
            $(".item").removeClass('active');
            $(this).addClass('active');
            if (!$(this).attr("id")) {
                $(".well").load(creativeEditUrl);
            } else {
                var id = parseInt($(this).attr("data-id"));
                $(".well").load(chapterEditUrl + id + "/edit.json");
            }
        });

        $(document).on("click", ".add", function() {
            $(".well").load(chapterEditUrl + "/new.json");
        });
    })();

</script>


